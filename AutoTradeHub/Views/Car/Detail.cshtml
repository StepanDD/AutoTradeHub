@using AutoTradeHub.ViewModels
@using Microsoft.JSInterop
@model CarVM
@inject IJSRuntime JS
@*
    For more information on enabling MVC for empty projects, visit https://go.microsoft.com/fwlink/?LinkID=397860
*@
@{
}

<div class="container mt-4">
	<div class="d-flex justify-content-between mb-4">
		<h2>@Model.Marka?.Name @Model.Model?.Name @Model.Year</h2>
		<h2>@Model.Price ₽</h2>
	</div>

	<div class="row">
		<div class="col">
			<div id="carouselExampleIndicators" class="carousel slide" data-bs-ride="carousel">
				<div class="carousel-indicators">
					<button type="button" data-bs-target="#carouselExampleIndicators" data-bs-slide-to="0" class="active" aria-current="true" aria-label="Slide 1"></button>
					<button type="button" data-bs-target="#carouselExampleIndicators" data-bs-slide-to="1" aria-label="Slide 2"></button>
					<button type="button" data-bs-target="#carouselExampleIndicators" data-bs-slide-to="2" aria-label="Slide 3"></button>
				</div>
				<div class="carousel-inner detail-carousel-inner">
					<div class="carousel-item active" data-bs-interval="600000">
						<img src="\img\KIA RIO 2019.jpg" class="carousel-item-img d-block w-100" alt="...">
					</div>
					<div class="carousel-item" data-bs-interval="600000">
						<img src="\img\mini-coupe-high-speed-drive-road-with-front-lights.jpg" class="carousel-item-img d-block w-100" alt="...">
					</div>
					<div class="carousel-item" data-bs-interval="600000">
						<img src="\img\sports-car-driving-asphalt-road-night-generative-ai.jpg" class="carousel-item-img d-block w-100" alt="...">
					</div>
				</div>
				<button class="carousel-control-prev" type="button" data-bs-target="#carouselExampleIndicators" data-bs-slide="prev">
					<span class="carousel-control-prev-icon" aria-hidden="true"></span>
					<span class="visually-hidden">Previous</span>
				</button>
				<button class="carousel-control-next" type="button" data-bs-target="#carouselExampleIndicators" data-bs-slide="next">
					<span class="carousel-control-next-icon" aria-hidden="true"></span>
					<span class="visually-hidden">Next</span>
				</button>
			</div>

			@if (User.Identity.IsAuthenticated)
			{
				<div class="d-flex justify-content-between mt-4">
					@if (ViewBag.IsInFavorite == false)
					{
						<button type="button" class="btn btn-outline-primary"
								onclick="favoriteButtonClick();" id="favoriteButton">
							Добавить в избранное
						</button>
					}
					else
					{
						<button type="button" class="btn btn-outline-danger"
								onclick="favoriteButtonClick();" id="favoriteButton">
							Удалить из избранного
						</button>
					}
					<button type="button" class="btn btn-outline-primary disabled"
							onclick="aaa();">
						Связаться с продавцом
					</button>
					<button type="button" class="btn btn-outline-primary disabled">Поделиться объявлением</button>
				</div>
			}
			else
			{
				<div class="d-flex justify-content-between mt-4 mb-3">
					<a type="button" asp-controller="Account" asp-action="Login"
					   class="btn btn-primary" style="width:49%">Войти</a>
					<a type="button" asp-controller="Account" asp-action="Register"
					   class="btn btn-outline-primary" style="width:49%">Зарегистрироваться</a>
				</div>
				<p>
					Войдите в свой аккаунт, чтобы иметь возможность сохранять понравившиеся объявления, делиться ими
					и контактировать с продавцами
				</p>
			}

			@if (User.Identity.IsAuthenticated && User.IsInRole("Admin"))
			{
				<div class="row mt-4">
					<div class="col-6">
						<div class="d-grid">
							<a asp-controller="Car" asp-action="Edit" asp-route-id="@Model.Id"
							   type="button" class="btn btn-outline-primary">
								Редактировать объявление
							</a>
						</div>
					</div>
					<div class="col-6">
						<div class="d-grid">
							<a asp-controller="Car" asp-action="Delete" asp-route-id="@Model.Id"
							   type="button" class="btn btn-outline-danger">
								Удалить объявление
							</a>
						</div>
					</div>
				</div>
			}
		</div>
		<div class="col">
			<div class="row">
				<div class="col-md-auto">
					<p class="text-muted">Двигатель</p>
					<p class="text-muted">Мощность</p>
					<p class="text-muted">Коробка передач</p>
					<p class="text-muted">Привод</p>
					<p class="text-muted">Тип кузова</p>
					<p class="text-muted">Цвет</p>
					<p class="text-muted">Пробег</p>
					<p class="text-muted">Руль</p>
					<p class="text-muted">Поколение</p>
				</div>
				<div class="col">
					<p>@Model.EngineType , @Model.EngineVolume л</p>
					<p>@Model.EnginePower л.с.</p>
					<p>@Model.Gearbox</p>
					<p>@Model.Privod</p>
					<p>@Model.BodyType</p>
					<p>@Model.Color?.Name</p>
					<p>@Model.Probeg км</p>
					<p>@Model.SteeringWheel</p>
					<p>@Model.Generation?.Name</p>
				</div>
				<div class="mt-4">
					<p class="text-muted">Описание</p>
					<p>@Model.Description</p>
				</div>
			</div>
		</div>
	</div>
</div>

@section Scripts {
	<script>
		function addToFavorite() {
			$.ajax({
				type: "GET",
				url: "https://localhost:44395/Car/AddToFavorite?carId=" + @Convert.ToString(Model.Id),
				dataType: "json",
				success: function (result) {
					console.log(result);
					changeFavoriteButton();
				},
				error: function (req, status, error) {
					console.log(req, status, error);
				}
			})
		}

		function deleteFromFavorite() {
			$.ajax({
				type: "GET",
				url: "https://localhost:44395/Car/DeleteFromFavorite?carId=" + @Convert.ToString(Model.Id),
				dataType: "json",
				success: function (result) {
					console.log(result);
					changeFavoriteButton();
				},
				error: function (req, status, error) {
					console.log(req, status, error);
				}
			})
		}

		function favoriteButtonClick() {
			if (document.getElementById("favoriteButton").className == "btn btn-outline-danger") {
				deleteFromFavorite();
			}
			else {
				addToFavorite();
			}
		}

		function changeFavoriteButton() {
			if (document.getElementById("favoriteButton").className == "btn btn-outline-danger") {
				updateFavoriteButton("white");
			}
			else {
				updateFavoriteButton("red");
			}
		}

		function updateFavoriteButton(color) {
			if (color == "red") {
				document.getElementById("favoriteButton").innerHTML = "Удалить из избранного";
				document.getElementById("favoriteButton").className = "btn btn-outline-danger";
			}
			else {
				document.getElementById("favoriteButton").innerHTML = "Добавить в избранное";
				document.getElementById("favoriteButton").className = "btn btn-outline-primary";
			}
		}

		function aaa() {
			alert("aaa");
		}
	</script>
}
